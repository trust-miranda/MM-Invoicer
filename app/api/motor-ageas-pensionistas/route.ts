import { NextResponse } from "next/server";
import sql from "mssql";

const config = {
  server: "192.168.1.240",
  database: "TRUST_GESTAO_CLINICA_PROD",
  user: "5033",
  password: "manel123456",
  options: {
    encrypt: false,
    enableArithAbort: true,
    requestTimeout: 600000,
  },
};

export async function GET() {
  try {
    const pool = await sql.connect(config);
    const result = await pool.request().query(`
WITH Headers AS (       
SELECT NEWID() as id,
pc.identidadeseguradora as identidade,
en.nomeExterno as seguradora,
cl.nome as nomesinistrado,
pc.idRamo as idRamo,
pes.estadoSinistro as estadoSinistro,
pec.estadoClinico as estadoClinico,
pc.ePensionista as pensionista,
pc.dataAdmissao as dataadmissao,
pc.dataalta as dataalta,
pc.idprocesso as idprocesso,
pc.numapolice as numapolice,
pc.numprocseguradora as numprocseguradora
FROM processoClinico pc WITH (NOLOCK)
LEFT JOIN cliente cl WITH (NOLOCK) ON pc.idcliente = cl.idcliente
LEFT JOIN processoEstadoClinico pec WITH (NOLOCK) ON pc.idProcessoEstadoClinico=pec.idProcessoEstadoClinico
LEFT JOIN processoEstadoSinistro pes WITH (NOLOCK) ON pc.idProcessoEstadoClinico=pes.idProcessoEstadoSinistro
LEFT JOIN entidade en WITH (NOLOCK) ON pc.idEntidadeSeguradora=en.idEntidade
WHERE pc.idprocesso IN ('234509',
'240429',
'240447',
'240452',
'240462',
'240469',
'240476',
'240485',
'240494',
'240777',
'241278',
'241293',
'241324',
'241352',
'241394',
'241975',
'242113',
'242195',
'242246',
'242350',
'242403',
'242519',
'242558',
'242635',
'242639',
'242937',
'242965',
'243030',
'243066',
'243152',
'243162',
'243383',
'243446',
'243669',
'243687',
'243692',
'243696',
'243703',
'243708',
'243740',
'243742',
'243744',
'243746',
'243755',
'243763',
'243834',
'243904',
'244010',
'244046',
'244204',
'244233',
'244306',
'244341',
'244515',
'244613',
'244724',
'245371',
'245374',
'245392',
'245921',
'246320',
'246533',
'246632',
'246642',
'246803',
'246819',
'247107',
'247263',
'247452',
'247453',
'247469',
'247902',
'247904',
'247908',
'247911',
'247912',
'247913',
'247915',
'247917',
'247921',
'247922',
'247926',
'247928',
'247929',
'247930',
'247932',
'247934',
'247938',
'247943',
'247946',
'247951',
'247952',
'247954',
'247956',
'247960',
'247962',
'247972',
'247973',
'247974',
'247976',
'247980',
'247988',
'248001',
'248010',
'248011',
'248062',
'248109',
'248113',
'248596',
'248598',
'248891',
'249199',
'249798',
'250215',
'250265',
'250313',
'251197',
'251202',
'251206',
'251211',
'251352',
'252335',
'252957',
'253028',
'253032',
'253035',
'253038',
'253039',
'253042',
'253045',
'253054',
'253058',
'253059',
'253072',
'253079',
'253322',
'253414',
'253815',
'254125',
'254158',
'254162',
'254181',
'254531',
'255026',
'255070',
'255203',
'255389',
'255875',
'256489',
'256640',
'257099',
'260415',
'260703',
'261561',
'262518',
'262972',
'263020',
'263341',
'264075',
'264154',
'265653',
'265821',
'267605',
'268692',
'268906',
'271489',
'272767',
'273991',
'275333',
'276004',
'276009',
'276319',
'277462',
'277719',
'277789',
'279506',
'279798',
'282839',
'285439',
'285852',
'288394',
'292589',
'294270',
'294555',
'295435',
'298812',
'311433',
'313051',
'313052',
'315070',
'315135',
'317024',
'317099',
'321054',
'323843',
'324207',
'324814',
'326201',
'331832',
'335317',
'335629',
'338332',
'338682',
'338703',
'338798',
'341886',
'342666',
'349863',
'351427',
'355166',
'357697',
'360087',
'361005',
'361992',
'364021',
'364538',
'373852',
'377231',
'378785',
'386450',
'390274',
'391908',
'393229',
'393383',
'393560',
'393926',
'406621',
'407663',
'408313',
'409113',
'409859',
'410262',
'411190',
'416373',
'417224',
'419958',
'420980',
'421707',
'424691',
'429653',
'432447',
'434355',
'435530',
'437258',
'451522',
'454587',
'459092',
'459611',
'459739',
'464485',
'467118',
'472152',
'474668',
'475930',
'477643',
'477699',
'479965',
'481445',
'481543',
'484169',
'484650',
'488919',
'489178',
'490394',
'490753',
'491054',
'493099',
'494148',
'498906',
'502924',
'503513',
'520327',
'521095',
'522403',
'522966',
'523784',
'525745',
'531549',
'533433',
'534031',
'535632',
'538293',
'549244')),

ResultLinhas AS (
SELECT 
LTRIM(RTRIM(u.nutente)) as idProcesso,
'' as idLinha,
u.ref as ref,
u.design as descricao,
u.qtt as qtt,
u.valor as valorunit,
bi.lobs2 as idrequisicao,
'' as idrequisicaoactomedico,
'1723849200' as datafinal,
'1718665200' as dataopen,
'nao' as texto,
null as idavenca
FROM PHC..u_facturatmp u WITH (NOLOCK)
LEFT JOIN PHC..bi (NOLOCK) ON u.stampo = bi.bistamp
WHERE u.u_facturatmpstamp IN ('MA24110811537,415000762',
'MA24110811537,415000076',
'MA24110711053,129000800',
'MA23092521564,352000200',
'MA24110811537,415000600',
'MA24110811537,415000562',
'MA24110811537,415000787',
'MA24110811537,415000802',
'MA24110811537,415000912',
'MA24110811537,415000992',
'MA24110811537,415000997',
'MA24101408927,708000794',
'MA24110811537,415000429',
'MA24102409403,600000791',
'MA23091818084,255000165',
'MA23091818084,255000166',
'MA24102207668,353000621',
'MA24110811537,415000968',
'MA24110811537,415000975',
'MA24100135570,081000780',
'MA24110811537,415000952',
'MA24102207668,353000832',
'MA24103009409,425000628',
'MA24032058366,721000826',
'MA24110790672,130000995',
'MA24110790672,130000994',
'MA23092521564,352000245',
'MA24092416014,437000748',
'MA24103109317,176000765',
'MA24101408927,708000798',
'MA24110711053,129001056',
'MA24103009409,425000629',
'MA24110811537,415000751',
'MA24110811537,415000976',
'MA24072712398,387000616',
'MA24072712400,104000616',
'MA24082822269,414000728',
'MA24082822269,414000727',
'MA24082822269,414000729',
'MA24102309741,127000819',
'MA24110711053,129001058',
'MA24110711053,129001057',
'MA24110711053,129000803',
'MA24110711053,129000801',
'MA24110711053,129000802',
'MA24110811537,415000755',
'MA24110711053,129000804',
'MA24091813659,441000788',
'MA24091813659,441000789',
'MA24091813659,441000790',
'MA24091813659,441000791',
'MA24091813659,441000792',
'MA24082733239,051000707',
'MA24082733239,051000708',
'MA23121819470,343000423',
'MA24080217239,375000657',
'MA24110811537,415000118',
'MA24090216081,547000734',
'MA24062419695,139000516',
'MA24070235571,906000567',
'MA24110811537,415000548',
'MA24110811537,415000527',
'MA24062419695,139000485',
'MA24110811537,415000097',
'MA24083017372,685000709',
'MA24110811537,415000356',
'MA24092416014,437000840',
'MA24082822269,414000704',
'MA24110811537,415000788',
'MA24110811537,415000007',
'MA24110811537,415000491',
'MA24110811537,415000335',
'MA24102809548,218001013',
'MA24102309741,127000820',
'MA24070843708,661000618',
'MA24110811537,415000497',
'MA24110811537,415000621',
'MA24110811537,415000529',
'MA24110811537,415000449',
'MA24110811537,415000696',
'MA24090216081,547000733',
'MA24110811537,415000081',
'MA24102409403,600000817',
'MA24110711053,129000028',
'MA24110811537,415000395',
'MA24102809548,218000952',
'MA24110811537,415000410',
'MA24110811537,415000698',
'MA24110811537,415000655',
'MA24110811537,415000683',
'MA24090516231,281000786',
'MA24061337212,431000389',
'MA24110811537,415000451',
'MA24103009409,425000655',
'MA24110790672,130000996',
'MA24110811537,415000077',
'MA24110811537,415000084',
'MA24110811537,415000091',
'MA24110811537,415000011',
'MA24110811537,415000017',
'MA24110811537,415000030',
'MA24110811537,415000048',
'MA24110811537,415000064',
'MA24091120592,164000827',
'MA24061738928,233000415',
'MA24110811537,415000114',
'MA24110811537,415000153',
'MA24110811537,415000186',
'MA24110811537,415000438',
'MA24080217239,375000662',
'MA24071542406,833000640',
'MA24110811537,415000324',
'MA24110811537,415000327',
'MA24110811537,415000359',
'MA24110811537,415000388',
'MA24102207668,353000624',
'MA24102207668,353000623',
'MA24102309741,127000821',
'MA24110711053,129000014',
'MA24110711053,129000015',
'MA24103009409,425000656',
'MA24102809548,218000954',
'MA24082116278,985000596',
'MA24092711866,238000748',
'MA24100135570,081000785',
'MA24110790672,130000997',
'MA24103109317,176000768',
'MA24102809548,218000953',
'MA24102809548,218000902',
'MA24110711053,129000808',
'MA24110711053,129000805',
'MA24110711053,129000810',
'MA24110711053,129000817',
'MA24110711053,129000813',
'MA24110711053,129000814',
'MA24110711053,129000815',
'MA24110711053,129000806',
'MA24110711053,129000822',
'MA24110711053,129000819',
'MA24110711053,129000807',
'MA24110711053,129000821',
'MA24110711053,129000809',
'MA24110711053,129000820',
'MA24110711053,129000811',
'MA24110711053,129000816',
'MA24110711053,129000818',
'MA24110711053,129000812',
'MA24102809548,218000901',
'MA24102809548,218000949',
'MA24110811537,415000752',
'MA24110811537,415000763',
'MA24110811537,415000756',
'MA24110811537,415000723',
'MA24110811537,415000903',
'MA24110811537,415000977',
'MA24110811537,415000895',
'MA24103009409,425000654',
'MA24102809548,218000951',
'MA24110811537,415000614',
'MA24110811537,415000615',
'MA24110811537,415000209',
'MA24110811537,415000599',
'MA24110811537,415000607',
'MA24110811537,415000608',
'MA24110811537,415000609',
'MA24110811537,415000610',
'MA24110811537,415000611',
'MA24110811537,415000612',
'MA24110811537,415000613',
'MA24110811537,415001003',
'MA24110811537,415000708',
'MA24110811537,415000709',
'MA24110811537,415000710',
'MA24100409930,656000809',
'MA24101135842,014000796',
'MA24110811537,415000055',
'MA24110811537,415000019',
'MA24110811537,415000119',
'MA24080217239,375000661',
'MA24110811537,415000382',
'MA24103009409,425000652',
'MA24102809548,218000948',
'MA24110811537,415000793',
'MA24102409403,600000815',
'MA24091120592,164000829',
'MA24110811537,415000171',
'MA24071542406,833000642',
'MA24110711053,129000823',
'MA24110711053,129001072',
'MA24102809548,218000956',
'MA24102809548,218000904',
'MA24072712400,104000617',
'MA24072712400,104000637',
'MA24072712400,104000655',
'MA24072712398,387000617',
'MA24072712398,387000637',
'MA24072712398,387000655',
'MA24032540029,904000357',
'MA24012670478,465000475',
'MA24012670478,465000476',
'MA24102809548,218000955',
'MA24102809548,218000903',
'MA24101008813,480000805',
'MA24101008813,480000806',
'MA24110811537,415000296',
'MA24093073944,263000782',
'MA24093073944,263000783',
'MA24093073944,263000784',
'MA24081751641,563000704',
'MA24103109317,176000810',
'MA24110109129,410000771',
'MA24102309741,127000822',
'MA24062419695,139000470',
'MA24081751641,563000705',
'MA24102309741,127000007',
'MA24110711053,129000017',
'MA24110711053,129000018',
'MA24102809548,218000957',
'MA24110109129,410000773',
'MA24103009409,425000657',
'MA24110711053,129000824',
'MA24110109129,410000772',
'MA24110711053,129000025',
'MA24110811537,415000678',
'MA24102809548,218001014',
'MA24070235571,906000573',
'MA24092416014,437000761',
'MA24103109317,176000786',
'MA24102207668,353000835',
'MA24110811537,415000829',
'MA24103109329,186000001',
'MA24103009409,425000631',
'MA24103109329,186000004',
'MA24103109329,186000011',
'MA24103109329,186000005',
'MA24110109129,410000774',
'MA24103109317,176000787',
'MA24102207668,353000625',
'MA24103109329,186000003',
'MA24102207668,353000628',
'MA24103109329,186000002',
'MA24103109329,186000007',
'MA24102207668,353000626',
'MA24102207668,353000627',
'MA24103109329,186000006',
'MA24103109329,186000009',
'MA24102207668,353000631',
'MA24102207668,353000629',
'MA24103109329,186000008',
'MA24102207668,353000630',
'MA24102207668,353000632',
'MA24103109329,186000010',
'MA24110109129,410000775',
'MA24042637985,490000361',
'MA24090516231,281000788',
'MA24040242058,885000376',
'MA24061738928,233000485',
'MA24091120592,164000831',
'MA24110811537,415000022',
'MA24110811537,415000061',
'MA24110711053,129000825',
'MA24071542406,833000711',
'MA24103009409,425000658',
'MA24103009409,425000659',
'MA24103009409,425000660',
'MA24110711053,129000013',
'MA24102409403,600000816',
'MA24110811537,415000904',
'MA24110811537,415000918',
'MA24110811537,415000937',
'MA24110811537,415000757',
'MA24110811537,415000764',
'MA24110811537,415000783',
'MA24110811537,415000606',
'MA24110811537,415000749',
'MA24110811537,415000919',
'MA24110811537,415000871',
'MA24110811537,415000712',
'MA24110811537,415000714',
'MA24110811537,415000736',
'MA24102907788,225000002',
'MA24110790672,130000003',
'MA24110711053,129001073',
'MA24100135570,081000789',
'MA24091120592,164000832',
'MA24061738928,233000486',
'MA24103109317,176000789',
'MA24071542406,833000643',
'MA24102409403,600000814',
'MA24102207668,353000633',
'MA24110811537,415000959',
'MA24110711053,129000827',
'MA24100712259,383000791',
'MA24110811537,415000089',
'MA24110811537,415000575',
'MA24103009409,425000632',
'MA24110711053,129000826',
'MA24102207668,353000837',
'MA24110711053,129000008',
'MA24110711053,129000009',
'MA24102809548,218000905',
'MA24102809548,218000958',
'MA24110811537,415000452',
'MA24110811537,415000121',
'MA24102207668,353000836',
'MA24102207668,353000635',
'MA24102207668,353000634',
'MA24102207668,353000834',
'MA24103009409,425000630',
'MA24103109317,176000783',
'MA24103109317,176000775',
'MA24103109317,176000779',
'MA24103109317,176000770',
'MA24103109317,176000776',
'MA24103109317,176000782',
'MA24103109317,176000773',
'MA24103109317,176000780',
'MA24103109317,176000769',
'MA24103109317,176000777',
'MA24103109317,176000778',
'MA24103109317,176000781',
'MA24103109317,176000784',
'MA24103109317,176000771',
'MA24103109317,176000772',
'MA24103109317,176000785',
'MA24103109317,176000774',
'MA24110711053,129000023',
'MA24102809548,218000959',
'MA24102809548,218000906',
'MA24110711053,129000021',
'MA24102809548,218001015',
'MA24103009409,425000633',
'MA24102409403,600000794',
'MA24102409403,600000796',
'MA24102409403,600000795',
'MA24102809548,218000001',
'MA24102309741,127000001',
'MA24102309741,127000002',
'MA24100712259,383000793',
'MA24103009409,425000634',
'MA24071542406,833000646',
'MA24110811537,415000770',
'MA24110811537,415000945',
'MA24102809548,218000907',
'MA24102809548,218000909',
'MA24102809548,218000960',
'MA24102809548,218000962',
'MA24102809548,218000963',
'MA24102809548,218000961',
'MA24102809548,218000908',
'MA24102809548,218000910',
'MA24102409403,600000797',
'MA23092521564,352000181',
'MA23091818084,255000682',
'MA23122848981,620000365',
'MA24012670478,465000479',
'MA24110811537,415000090',
'MA24110811537,415000384',
'MA24102809548,218000911',
'MA24102809548,218000964',
'MA24110811537,415000524',
'MA24110811537,415000215',
'MA24110811537,415000789',
'MA24093073944,263000697',
'MA24093073944,263000703',
'MA24110109129,410000779',
'MA23091818084,255000251',
'MA23091818084,255000278',
'MA23091818084,255000556',
'MA24110109129,410000778',
'MA24110109129,410000777',
'MA24103109317,176000790',
'MA24103109317,176000791',
'MA24102207668,353000838',
'MA24110811537,415000024',
'MA24110109129,410000780',
'MA24110109129,410000781',
'MA24102309741,127000823',
'MA24110811537,415000765',
'MA24110811537,415000782',
'MA24110811537,415000576',
'MA24102309741,127000824',
'MA24070235571,906000682',
'MA24080217239,375000598',
'MA24032058366,721000785',
'MA24032058366,721000786',
'MA24110811537,415000570',
'MA24110811537,415000571',
'MA24041566376,620000340',
'MA24103009409,425000635',
'MA24110711053,129000012',
'MA24102809548,218000912',
'MA24102809548,218000965',
'MA24110811537,415000391',
'MA24110811537,415000392',
'MA24110811537,415000453',
'MA24070235571,906000575',
'MA24110811537,415000425',
'MA24110811537,415000690',
'MA24072452851,987000654',
'MA24110790672,130000998',
'MA24061738928,233000443',
'MA24061738928,233000488',
'MA24061738928,233000489',
'MA24110811537,415000062',
'MA24110811537,415000049',
'MA24110811537,415000029',
'MA24110811537,415000078',
'MA24100712259,383000795',
'MA24093073944,263000768',
'MA24110811537,415000389',
'MA24071542406,833000647',
'MA24110811537,415000347',
'MA24110711053,129000829',
'MA24110711053,129000024',
'MA24110109129,410000783',
'MA24102809548,218001016',
'MA24110811537,415000753',
'MA24110811537,415000741',
'MA24110811537,415000920',
'MA24110811537,415000978',
'MA24110811537,415000942',
'MA24110811537,415000879',
'MA24110811537,415000396',
'MA24110811537,415000969',
'MA24110811537,415000979',
'MA24110790672,130000999',
'MA24110811537,415000985',
'MA24110811537,415000939',
'MA24110811537,415000960',
'MA24110811537,415000929',
'MA24110811537,415000815',
'MA24110811537,415000826',
'MA24110811537,415000794',
'MA24110811537,415000786',
'MA24110811537,415000754',
'MA24110811537,415000694',
'MA24110811537,415000784',
'MA24110811537,415000781',
'MA24110811537,415000659',
'MA24110811537,415000601',
'MA24110811537,415000642',
'MA24110790672,130001000',
'MA24042637985,490000428',
'MA24082116278,985000602',
'MA24082116278,985000603',
'MA24061019428,225000366',
'MA24102809548,218000914',
'MA24102809548,218000968',
'MA24102207668,353000839',
'MA24102309741,127000008',
'MA24102309741,127000009',
'MA24110711053,129001060',
'MA24102409403,600000819',
'MA24102409403,600000820',
'MA24102207668,353000840',
'MA24103109317,176000792',
'MA24091120592,164000833',
'MA24070235571,906000576',
'MA24071542406,833000648',
'MA24071542406,833000649',
'MA24102309741,127000825',
'MA24110711053,129000022',
'MA24103009409,425000636',
'MA24110711053,129001061',
'MA24102309741,127000826',
'MA23080740201,316000127',
'MA23080740201,316000128',
'MA23080740201,316000129',
'MA23080740201,316000130',
'MA24102309741,127000827',
'MA24102409403,600000812',
'MA24110711053,129001074',
'MA24103009409,425000663',
'MA24102809548,218000969',
'MA24110790672,130001001',
'MA24070235571,906000616',
'MA24092416014,437000776',
'MA24110811537,415000393',
'MA24110811537,415000684',
'MA24110811537,415000656',
'MA24110811537,415000454',
'MA24070235571,906000577',
'MA24110811537,415000411',
'MA24110811537,415000412',
'MA24100712259,383000797',
'MA24110811537,415000085',
'MA24110811537,415000196',
'MA24110811537,415000197',
'MA24110811537,415000156',
'MA24102207668,353000841',
'MA24080217239,375000670',
'MA24110811537,415000331',
'MA24110711053,129000830',
'MA24110811537,415000372',
'MA24102309741,127000828',
'MA24110711053,129001075',
'MA24102309741,127000006',
'MA24102207668,353000842',
'MA24110711053,129000831',
'MA24102309741,127000003',
'MA24110711053,129001062',
'MA24102309741,127000829',
'MA24092416014,437000778',
'MA24110711053,129000016',
'MA24102809548,218000916',
'MA24102809548,218000971',
'MA24102809548,218000970',
'MA24102809548,218000915',
'MA24110711053,129000832',
'MA24110711053,129000019',
'MA24110711053,129000020',
'MA24110711053,129000001',
'MA24102309741,127000830',
'MA24110811537,415000406',
'MA24110711053,129000005',
'MA24102207668,353000001',
'MA24101713780,455000848',
'MA24101135842,014000799',
'MA24061738928,233000497',
'MA24110711053,129000026',
'MA24102409403,600000818',
'MA24062419695,139000523',
'MA24071542406,833000618',
'MA24081316847,296000705',
'MA24110711053,129000027',
'MA24102309741,127000004',
'MA24110790672,130001002',
'MA24101108754,259000808',
'MA24103009420,833000004',
'MA24102809560,957000004',
'MA24102809560,957000005',
'MA24103009420,833000005',
'MA24103009420,833000006',
'MA24102809560,957000007',
'MA24110109129,410000786',
'MA24110711053,129001080',
'MA24102809560,957000001',
'MA24103009420,833000001',
'MA24103009420,833000002',
'MA24102809560,957000002',
'MA24102809560,957000008',
'MA24103009420,833000007',
'MA24110109129,410000789',
'MA24110109129,410000788',
'MA24110711053,129001079',
'MA24103009420,833000003',
'MA24102809560,957000003',
'MA24102809560,957000009',
'MA24103009420,833000008',
'MA24110711053,129001076',
'MA24110109129,410000791',
'MA24110109129,410000787',
'MA24110109129,410000792',
'MA24110711053,129001081',
'MA24110711053,129001082',
'MA24110711053,129001077',
'MA24110109129,410000784',
'MA24110109129,410000790',
'MA24110711053,129001078',
'MA24103009420,833000009',
'MA24102809560,957000006',
'MA24110811537,415000083',
'MA24110711053,129001083',
'MA24082116278,985000605',
'MA24072452851,987000772',
'MA24110811537,415000455',
'MA24061738928,233000499',
'MA24071542406,833000651',
'MA24102809548,218000974',
'MA24103009409,425000664',
'MA24102809548,218000973',
'MA24102809548,218000918',
'MA24102809548,218000917',
'MA24102809548,218000972',
'MA24102207668,353000636',
'MA24110711053,129001085',
'MA24110811537,415000685',
'MA24103109317,176000793',
'MA24102809548,218000975',
'MA24102809548,218000919',
'MA24082017466,088000695',
'MA24082017466,088000696',
'MA24110711053,129000006',
'MA23091818084,255000078',
'MA24082116278,985000606',
'MA24062419695,139000524',
'MA24101713780,455000851',
'MA24072452851,987000603',
'MA24110711053,129000004',
'MA24102309741,127000831',
'MA24103009409,425000637',
'MA24102809548,218000920',
'MA24102809548,218000976',
'MA24102207668,353000637',
'MA24110811537,415000987',
'MA24110790672,130001003',
'MA24100911506,906000793',
'MA24100409930,656000792',
'MA24110811537,415000058',
'MA24110811537,415000486',
'MA24110811537,415000650',
'MA24080217239,375000671',
'MA24110109129,410000793',
'MA24110811537,415000980',
'MA24110811537,415000970',
'MA24102809548,218000978',
'MA24102809548,218000922',
'MA24080917818,962000632',
'MA24100712259,383000803',
'MA24110811537,415000582',
'MA24102809548,218000979',
'MA24102809548,218000923',
'MA24103009409,425000638',
'MA24110711053,129001087',
'MA24110811537,415000953',
'MA24102309741,127000005',
'MA24072712398,387000661',
'MA24072712400,104000661',
'MA24110711053,129000002',
'MA24102809548,218000982',
'MA24102809548,218000926',
'MA24102809548,218000924',
'MA24102809548,218000980',
'MA24102809548,218000981',
'MA24102809548,218000925',
'MA24110811537,415000122',
'MA24071542406,833000653',
'MA24103109317,176000794',
'MA24110811537,415000013',
'MA24110811537,415000247',
'MA24110811537,415000530',
'MA24081316847,296000707',
'MA24110811537,415000366',
'MA24091636368,356000760',
'MA24100208982,569000787',
'MA24110811537,415000444',
'MA24110811537,415000663',
'MA24102309741,127000833',
'MA24110711053,129000003',
'MA24102309741,127000834',
'MA24102809548,218001017',
'MA24102809548,218000983',
'MA24103009409,425000665',
'MA24110811537,415000095',
'MA24092416014,437000795',
'MA24110711053,129000833',
'MA24110811537,415000099',
'MA24110811537,415000101',
'MA24110811537,415000102',
'MA24110811537,415000123',
'MA24110811537,415000092',
'MA24103109317,176000795',
'MA24110811537,415000174',
'MA24061738928,233000502',
'MA24061738928,233000503',
'MA24110811537,415000414',
'MA24061337212,431000398',
'MA24090516231,281000793',
'MA24072452851,987000778',
'MA24072452851,987000663',
'MA24110811537,415000413',
'MA24110811537,415000668',
'MA24052438961,586000372',
'MA24052062948,160000435',
'MA24110811537,415000368',
'MA24110811537,415000363',
'MA24110811537,415000351',
'MA24110811537,415000326',
'MA24071542406,833000716',
'MA24102809548,218000984',
'MA24102809548,218000927',
'MA24100712259,383000807',
'MA24110790672,130001004',
'MA24101713780,455000622',
'MA24110109129,410000794',
'MA24072452851,987000664',
'MA24070235571,906000621',
'MA24092416014,437000798',
'MA24071542406,833000698',
'MA24110711053,129000834',
'MA24110790672,130000004',
'MA24102207668,353000638',
'MA24110811537,415000074',
'MA24103009409,425000667',
'MA24102809548,218000986',
'MA24100135570,081000797',
'MA24102809548,218000985',
'MA24103009409,425000666',
'MA24062419695,139000464',
'MA24062419695,139000463',
'MA24060319221,806000402',
'MA24061738928,233000463',
'MA24101713780,455000859',
'MA24061337212,431000378',
'MA24083017372,685000732',
'MA24083017372,685000733',
'MA24083017372,685000734',
'MA24102207668,353000639',
'MA24103009409,425000639',
'MA24110811537,415000724',
'MA24102409403,600000813',
'MA24102809548,218000928',
'MA24102809548,218000987',
'MA24110711053,129001088',
'MA24110711053,129001089',
'MA24102809548,218000988',
'MA24102809548,218000929',
'MA24102809548,218000930',
'MA24102809548,218000989',
'MA24062542959,896000508',
'MA24062542959,896000511',
'MA24080517548,002000622',
'MA24051341004,336000393',
'MA23112043452,978000345',
'MA24110811537,415000445',
'MA23112719151,308000360',
'MA23112719151,308000361',
'MA23112719151,308000362',
'MA24082822269,414000717',
'MA24110811537,415000026',
'MA24110811537,415000500',
'MA24110811537,415000312',
'MA24101008813,480000808',
'MA23091818084,255000350',
'MA24110711053,129000010',
'MA24110711053,129000011',
'MA24103009409,425000668',
'MA24102809548,218000991',
'MA24110811537,415000961',
'MA24110811537,415000938',
'MA24110811537,415000808',
'MA24110811537,415000872',
'MA24110811537,415000889',
'MA24093073944,263000583',
'MA24093073944,263000584',
'MA24102309741,127000835',
'MA24102309741,127000836',
'MA24100409930,656000795',
'MA24110811537,415000758',
'MA24110711053,129001090',
'MA24110711053,129001091',
'MA24110811537,415000014',
'MA24110790672,130000001',
'MA24110790672,130000002',
'MA24110711053,129001063',
'MA24052062948,160000387',
'MA24110811537,415000088',
'MA24110811537,415000971',
'MA24110811537,415000981',
'MA24070843708,661000623',
'MA24103109317,176000798',
'MA24103109317,176000797',
'MA24110811537,415000820',
'MA24110811537,415000572',
'MA24110811537,415000004',
'MA24110811537,415000830',
'MA24110811537,415000823',
'MA24110811537,415000873',
'MA24110811537,415000250',
'MA24110811537,415000440',
'MA24110811537,415000192',
'MA24110811537,415000176',
'MA24110811537,415000073',
'MA24110811537,415000096',
'MA24110811537,415000020',
'MA24110811537,415000035',
'MA24110811537,415000039',
'MA24110811537,415000390',
'MA24103009409,425000640',
'MA24110811537,415000629',
'MA23092521564,352000300',
'MA24103009409,425000641',
'MA24110811537,415000168',
'MA24110811537,415000812',
'MA24102309741,127000838',
'MA24102309741,127000837',
'MA24102809548,218001018',
'MA24110109129,410000795',
'MA24102207668,353000844',
'MA24102809548,218000993',
'MA24102809548,218000933',
'MA24102409403,600000800',
'MA24102809548,218000934',
'MA24102809548,218000994',
'MA24102907788,225000001',
'MA24101713780,455000862',
'MA24102809548,218000936',
'MA24102809548,218000996',
'MA24091220033,993000770',
'MA24103009409,425000642',
'MA24102809548,218000995',
'MA24061019428,225000377',
'MA24061019428,225000376',
'MA24081516586,161000699',
'MA24090516231,281000799',
'MA24102409403,600000801',
'MA23091818084,255000352',
'MA24051341004,336000416',
'MA24051341004,336000417',
'MA23121819470,343000389',
'MA24032540029,904000380',
'MA24091813659,441000806',
'MA24091813659,441000804',
'MA24091813659,441000803',
'MA24091813659,441000802',
'MA24091813659,441000800',
'MA24091813659,441000807',
'MA24091813659,441000805',
'MA24091813659,441000799',
'MA24091813659,441000797',
'MA24093073944,263000797',
'MA24091813659,441000798',
'MA24091813659,441000801',
'MA24093073944,263000791',
'MA24093073944,263000795',
'MA24093073944,263000796',
'MA24093073944,263000798',
'MA24093073944,263000799',
'MA24093073944,263000800',
'MA24093073944,263000792',
'MA24093073944,263000794',
'MA24093073944,263000793',
'MA24110811537,415000670',
'MA24091120592,164000842',
'MA24103009409,425000643',
'MA24101135842,014000806',
'MA24110811537,415000840',
'MA24110811537,415000887',
'MA24110811537,415000907',
'MA24092611895,741000767',
'MA24100135570,081000798',
'MA24110711053,129001092',
'MA24110811537,415000460',
'MA24091120592,164000844',
'MA24110811537,415000323',
'MA24040242058,885000380',
'MA24103009409,425000644',
'MA24092463737,164000607',
'MA24102809548,218000997',
'MA24102809548,218000937',
'MA24110711053,129000007',
'MA24101713780,455000625',
'MA24110811537,415000040',
'MA24110711053,129001064',
'MA24110711053,129000835',
'MA24102809560,957000012',
'MA24110811537,415000735',
'MA24110811537,415000707',
'MA24110811537,415000725',
'MA24110811537,415001004',
'MA24110811537,415000848',
'MA24110811537,415000805',
'MA24110811537,415000643',
'MA24110811537,415000646',
'MA24110811537,415000660',
'MA24110811537,415000651',
'MA24110811537,415000631',
'MA24071542406,833000703',
'MA24102207668,353000640',
'MA24110811537,415000116',
'MA24110811537,415000053',
'MA24110811537,415000054',
'MA24103009409,425000645',
'MA24102809548,218000998',
'MA24102809548,218000999',
'MA24102809548,218000938',
'MA24102809548,218000939',
'MA24102809548,218001001',
'MA24103009409,425000670',
'MA24110109129,410000797',
'MA24103009409,425000669',
'MA24110109129,410000796',
'MA24110811537,415000423',
'MA24110811537,415000424',
'MA24102809548,218001000',
'MA24110811537,415000397',
'MA24051341004,336000420',
'MA24110811537,415000107',
'MA24110811537,415000103',
'MA24110811537,415000068',
'MA24110811537,415000069',
'MA24110811537,415000086',
'MA24092416014,437000818',
'MA24110811537,415000439',
'MA24061738928,233000473',
'MA24061738928,233000474',
'MA24081516586,161000694',
'MA24080217239,375000675',
'MA24080217239,375000676',
'MA24071542406,833000704',
'MA24071542406,833000721',
'MA24110811537,415000332',
'MA24110811537,415000333',
'MA24110811537,415000338',
'MA24102809548,218001019',
'MA24102809548,218001020',
'MA24103009409,425000646',
'MA24110811537,415000759',
'MA24110109129,410000798',
'MA24110811537,415000982',
'MA24110811537,415000972',
'MA24092416014,437000822',
'MA24092416014,437000823',
'MA24081751641,563000710',
'MA24103109329,186000012',
'MA24103109329,186000015',
'MA24103109329,186000017',
'MA24103109317,176000800',
'MA24110711053,129000836',
'MA24103109329,186000018',
'MA24103109329,186000013',
'MA24103109329,186000014',
'MA24103109329,186000021',
'MA24103109329,186000019',
'MA24103109329,186000020',
'MA24110711053,129000837',
'MA24103109329,186000016',
'MA24101008813,480000811',
'MA24102207668,353000641',
'MA24102207668,353000642',
'MA24102207668,353000845',
'MA24070235571,906000601',
'MA24091120592,164000848',
'MA24070843708,661000609',
'MA24062419695,139000495',
'MA24102809548,218001021',
'ass2410318195,8350000-1',
'MA24102809548,218001003',
'MA24102809548,218000941',
'MA24051341004,336000334',
'MA24052062948,160000451',
'MA24051341004,336000396',
'MA24051341004,336000423',
'MA24061738928,233000512',
'MA24091120592,164000825',
'MA24100712259,383000811',
'MA24082822269,414000741',
'MA24070235571,906000582',
'MA24042637985,490000373',
'MA24110811537,415000681',
'MA24110711053,129001065',
'MA24110811537,415000924',
'MA24110811537,415000973',
'MA24110811537,415000983',
'MA24103009409,425000671',
'MA24102809548,218001004',
'MA24102809548,218001006',
'MA24103009409,425000672',
'MA24102309741,127000840',
'MA24102809548,218001022',
'MA24110811537,415000771',
'MA24110811537,415000795',
'MA24110711053,129000838',
'MA24103009409,425000647',
'MA24110811537,415000464',
'MA24110811537,415000682',
'MA24110811537,415000124',
'MA24110811537,415000813',
'MA24110811537,415000866',
'MA24110811537,415000901',
'MA24110811537,415000841',
'MA24110811537,415000844',
'MA24110811537,415000932',
'MA24110811537,415001000',
'MA24110811537,415000104',
'MA24110811537,415000108',
'MA24110811537,415000016',
'MA24110811537,415000219',
'MA24110811537,415000226',
'MA24110811537,415000008',
'MA24110811537,415000587',
'MA24110811537,415000602',
'MA24110811537,415000619',
'MA24110811537,415000597',
'MA24110811537,415000528',
'MA24110811537,415000006',
'MA24062419695,139000532',
'MA24110811537,415000349',
'MA24110811537,415000816',
'MA24110811537,415000809',
'MA24110811537,415000876',
'MA24110811537,415000883',
'MA24110811537,415000925',
'MA24110811537,415000768',
'MA24101713780,455000873',
'MA24101713780,455000872',
'MA24103109317,176000801',
'MA24102207668,353000846',
'MA24103009420,833000011',
'MA24102809560,957000011',
'MA24102809560,957000010',
'MA24103009420,833000010',
'MA24103009409,425000673',
'MA24102809548,218001007',
'MA24093073944,263000817',
'MA24093073944,263000818',
'MA24093073944,263000819',
'MA24093073944,263000820',
'MA24093073944,263000821',
'MA24093073944,263000822',
'MA24052438961,586000353',
'MA24072452851,987000786',
'MA24072452851,987000787',
'MA24072452851,987000792',
'MA24082116278,985000618',
'MA24082116278,985000617',
'MA24072452851,987000788',
'MA24072452851,987000789',
'MA24052438961,586000355',
'MA24110711053,129001066',
'MA24110711053,129001067',
'MA24101108754,259000845',
'MA24101108754,259000841',
'MA24101108754,259000838',
'MA24101108754,259000839',
'MA24101108754,259000840',
'MA24101108754,259000842',
'MA24101108754,259000834',
'MA24101108754,259000835',
'MA24101108754,259000846',
'MA24101108754,259000832',
'MA24101108754,259000844',
'MA24101108754,259000833',
'MA24101108754,259000843',
'MA24101108754,259000836',
'MA24101108754,259000837',
'MA24110811537,415000539',
'MA24110811537,415000540',
'MA24103009409,425000648',
'MA24102309741,127000843',
'MA24102809548,218001023',
'MA24110811537,415000545',
'MA24110811537,415000398',
'MA24110811537,415000499',
'MA24110811537,415000442',
'MA24100409930,656000797',
'MA24110811537,415000109',
'MA24080217239,375000678',
'MA24110811537,415000070',
'MA24110811537,415000044',
'MA24110811537,415000470',
'MA24110711053,129000840',
'MA24110811537,415000697',
'MA24110811537,415000028',
'MA24110811537,415000369',
'MA24110811537,415000842',
'MA24103009409,425000649',
'MA24090516231,281000803',
'MA24110811537,415000394',
'MA24110811537,415000067',
'MA24110811537,415000041',
'MA24110811537,415000027',
'MA24092416014,437000824',
'MA24110811537,415000129',
'MA24071542406,833000706',
'MA24102309741,127000844',
'MA24103009409,425000674',
'MA24102809548,218001008',
'MA24102409403,600000804',
'MA24110811537,415000358',
'MA24072452851,987000613',
'MA24110811537,415000009',
'MA24110811537,415000010',
'MA24110811537,415000025',
'MA24110811537,415000767',
'MA24102309741,127000845',
'MA24061738928,233000481',
'MA24103109317,176000802',
'MA24101713780,455000630',
'MA24110811537,415000591',
'MA24100208982,569000578',
'MA24051341004,336000398',
'MA24102309741,127000846',
'MA24110811537,415000130',
'MA24110811537,415000131',
'MA24110811537,415000105',
'MA24110811537,415000962',
'MA24110811537,415000133',
'MA24110811537,415000138',
'MA24110811537,415000158',
'MA24110811537,415000151',
'MA24110811537,415000177',
'MA24110811537,415000185',
'MA24071542406,833000685',
'MA24082822269,414000743',
'MA24091120592,164000798',
'MA24092416014,437000826',
'MA24110811537,415000126',
'MA24110811537,415000127',
'MA24110811537,415000140',
'MA24110811537,415000141',
'MA24110811537,415000142',
'MA24110811537,415000797',
'MA24110811537,415000810',
'MA24102809548,218001024',
'MA24110811537,415000699',
'MA24051341004,336000400',
'MA24110811537,415000180',
'MA24110811537,415000334',
'MA24110811537,415000353',
'MA24110811537,415000426',
'MA24110811537,415000401',
'MA24102809548,218000943',
'MA24102809548,218001009',
'MA24110811537,415000692',
'MA24110811537,415000658',
'MA24110811537,415000585',
'MA24110811537,415000553',
'MA24110811537,415000567',
'MA24110811537,415000627',
'MA24110811537,415000641',
'MA24110811537,415000727',
'MA24110811537,415000704',
'MA24110811537,415000827',
'MA24110811537,415000847',
'MA24110811537,415000878',
'MA24110811537,415000963',
'MA24110811537,415000905',
'MA24110811537,415000644',
'MA24110811537,415000403',
'MA24110711053,129001068',
'MA24110811537,415000760',
'MA24103109317,176000803',
'MA24093073944,263000842',
'MA24093073944,263000843',
'MA24093073944,263000844',
'MA24100911506,906000812',
'MA24061337212,431000405',
'MA24102809548,218000328',
'MA24110811537,415000814',
'MA24102809548,218000326',
'MA24102809548,218000327',
'MA24102809548,218000538',
'MA24102809548,218000887',
'MA24102809548,218000549',
'MA24103109317,176000805',
'MA24102809548,218000417',
'MA24102809548,218000413',
'MA24102809548,218000414',
'MA24102809548,218000443',
'MA24102809548,218000338',
'MA24102809548,218000873',
'MA24102809548,218000870',
'MA24102809548,218000339',
'MA24102809548,218000340',
'MA24102809548,218000877',
'MA24102809548,218000882',
'MA24102809548,218000341',
'MA24102809548,218000342',
'MA24102809548,218000343',
'MA24102809548,218000875',
'MA24102809548,218000876',
'MA24102809548,218000865',
'MA24102809548,218000874',
'MA24102809548,218000344',
'MA24102809548,218000345',
'MA24102809548,218000868',
'MA24102809548,218000863',
'MA24102809548,218000864',
'MA24102809548,218000872',
'MA24102809548,218000881',
'MA24102809548,218000867',
'MA24102809548,218000879',
'MA24102809548,218000880',
'MA24102809548,218000862',
'MA24102809548,218000878',
'MA24102809548,218000869',
'MA24102809548,218000415',
'MA24102809548,218001035',
'MA24102809548,218000346',
'MA24102809548,218000871',
'MA24102809548,218000866',
'MA24102809548,218000347',
'MA24102809548,218000416',
'MA24102809548,218001025',
'MA24110811537,415000654',
'MA24091813659,441000568',
'MA24091813659,441000574',
'MA24091813659,441000704',
'MA24091813659,441000682',
'MA24091813659,441000720',
'MA24091813659,441000733',
'MA24091813659,441000673',
'MA24110811537,415000630',
'MA24110811537,415000666',
'MA24110811537,415000679',
'MA24110811537,415000667',
'MA24102207668,353000644',
'MA24100712259,383000816',
'MA24072452851,987000711',
'MA23101638322,180000216',
'MA24020548798,638000230',
'MA24020548798,638000235',
'MA24020548798,638000240',
'MA24020548798,638000244',
'MA24020548798,638000434',
'MA24020548798,638000477',
'MA24102809548,218001026',
'MA24110811537,415000974',
'MA24110811537,415000984',
'MA24102809548,218001027',
'MA24102809548,218001028',
'MA24051341004,336000336',
'MA24082116278,985000619',
'MA24101713780,455000835',
'MA24080917818,962000520',
'MA24080917818,962000494',
'MA24080917818,962000651',
'MA24110711063,032000001',
'MA24110711063,032000005',
'MA24110711063,032000003',
'MA24110711063,032000011',
'MA24110711053,129001094',
'MA24110790672,130001005',
'MA24110711063,032000004',
'MA24110711063,032000010',
'MA24110711063,032000006',
'MA24110711063,032000002',
'MA24110711063,032000009',
'MA24110711063,032000008',
'MA24110711063,032000007',
'MA24042637985,490000403',
'MA24051341004,336000403',
'MA24041566376,620000478',
'MA24110811537,415000541',
'MA24110811537,415000632',
'MA24073020319,522000570',
'MA24073020319,522000583',
'MA24073020319,522000587',
'MA24091636368,356000766',
'MA24102809548,218001011',
'MA24103009409,425000675',
'MA24102809548,218001029',
'MA24102409403,600000807',
'MAM24110778578,7680000-1',
'MA24072712400,104000667',
'MA24072712398,387000667',
'MA24102207668,353000847',
'MA24101135842,014000807',
'MA24102409403,600000803',
'MA24060319221,806000359',
'MA24061738928,233000483',
'MA24051341004,336000428',
'MA24052438961,586000483',
'MA24052062948,160000453',
'MA24051341004,336000473',
'MA24082116278,985000621',
'MA24102309741,127000850',
'MA24092416014,437000835',
'MA24101713780,455000634',
'MA24102309741,127000848',
'MA24102309741,127000849',
'MA24102809548,218001030',
'MA24091120592,164000705',
'MA24091120592,164000578',
'MA24091120592,164000479',
'MA24091120592,164000480',
'MA24091120592,164000564',
'MA24091120592,164000759',
'MA24110811537,415000988',
'MA24110811537,415000637',
'MA24080217239,375000506',
'MA24103109317,176000806',
'MA24103109317,176000807',
'MA24110811537,415000993',
'MA24110811537,415000994',
'MA24093073944,263000639',
'MA24102809548,218001012',
'MA24102809548,218000945',
'MA24110811537,415000677',
'MA24110811537,415000680',
'MA24110811537,415000966',
'MA24110811537,415000852',
'MA24110811537,415000843',
'MA24110811537,415000796',
'MA24110811537,415000828',
'MA24110811537,415000837',
'MA24081516586,161000468',
'MA24093073944,263000739',
'MA24103009409,425000650',
'MA24110711053,129001069',
'MA24080217239,375000530',
'MA24100135570,081000807',
'MA24110711053,129001070',
'MA24091120592,164000853',
'MA24080517548,002000631',
'MA24102809548,218001031',
'MA24110811537,415000769',
'MA24102409403,600000554',
'MA24101452760,343000582',
'MA24101452760,343000743',
'MA24102309741,127000851',
'MA24100712259,383000817',
'MA24100712259,383000818',
'MA24102207668,353000848',
'MA24072452851,987000764',
'MA24103109317,176000808',
'MA24103109329,186000027',
'MA24103109329,186000026',
'MA24103109317,176000705',
'MA24103109317,176000706',
'MA24103109317,176000911',
'MA24103109329,186000029',
'MA24103109329,186000023',
'MA24103109329,186000030',
'MA24103109329,186000024',
'MA24103109329,186000025',
'MA24103109329,186000028',
'MA24103109329,186000022',
'MA24103109317,176000760',
'MA24103109317,176000895',
'MA24103109317,176000946',
'MA24103109317,176000989',
'MA24102207668,353000849',
'MA24110109129,410000801',
'MA24110811537,415000744',
'MA24101108754,259000855',
'MA24101108754,259000854',
'MA24082917265,802000727',
'MA24082917265,802000729',
'MA24082917265,802000728',
'MA24092611895,741000780',
'MA24101713780,455000728',
'MA24101713780,455000736',
'MA24101713780,455000709',
'MA24101713780,455000727',
'MA24101452760,343000674',
'MA24101108754,259000857',
'MA24110711053,129001071',
'MA24110811537,415000761',
'MA24110811537,415000869',
'MA24110811537,415000885',
'MA24100911506,906000816',
'MA24110811537,415000989',
'MA24110711053,129001095'))

SELECT h.*, l.idLinha, l.ref, l.descricao, l.qtt, l.valorunit, l.idrequisicao, l.idrequisicaoactomedico, l.datafinal, l.dataopen, l.texto, l.idavenca
FROM Headers h, ResultLinhas l
WHERE h.idprocesso=l.idProcesso 
AND l.valorunit > 0
AND h.numprocseguradora > ''
ORDER BY h.idprocesso, l.ref;
        `);

    // Group by idProcesso and add row index for idLinha
    const groupedResult = result.recordset.reduce((acc, row) => {
      const idProcesso = row.idprocesso ? row.idprocesso.toString().trim() : "";

      if (!acc[idProcesso]) {
        acc[idProcesso] = {
          id: row.id ? row.id.toString().trim() : "",
          identidade: row.identidade ? parseInt(row.identidade, 10) : null,
          seguradora: row.seguradora ? row.seguradora.trim() : "",
          nomesinistrado: row.nomesinistrado
            ? row.nomesinistrado.toString().trim()
            : "",
          idRamo: row.idRamo ? row.idRamo.toString().trim() : "",
          estadoSinistro: row.estadoSinistro
            ? row.estadoSinistro.toString().trim()
            : "",
          estadoClinico: row.estadoClinico
            ? row.estadoClinico.toString().trim()
            : "",
          pensionista: row.pensionista ? row.pensionista.toString().trim() : "",
          dataadmissao: row.dataadmissao
            ? row.dataadmissao.toString().trim()
            : null,
          dataalta: row.dataalta ? row.dataalta.toString().trim() : null,
          idprocesso: idProcesso,
          numapolice: row.numapolice ? row.numapolice.toString().trim() : "",
          numprocseguradora: row.numprocseguradora
            ? row.numprocseguradora.toString().trim()
            : "",
          ResultLinhas: [],
          idLinhaCounter: 1,
        };
      }

      acc[idProcesso].ResultLinhas.push({
        idlinha: acc[idProcesso].idLinhaCounter,
        ref: row.ref ? row.ref.toString().trim() : "",
        descricao: row.descricao ? row.descricao.toString().trim() : "",
        qtt: row.qtt || 0,
        valorunit: row.valorunit ? parseFloat(row.valorunit) : 0,
        idrequisicao: row.idrequisicao
          ? row.idrequisicao.toString().trim()
          : "0",
        idrequisicaoactomedico: row.idrequisicaoactomedico
          ? row.idrequisicaoactomedico.toString().trim()
          : "",
        datafinal: row.datafinal ? row.datafinal.toString().trim() : "",
        dataopen: row.dataopen ? row.dataopen.toString().trim() : "",
        idavenca: row.idavenca || null,
      });

      acc[idProcesso].idLinhaCounter += 1;

      return acc;
    }, {});

    const formattedResult = Object.values(groupedResult).map(
      ({ idLinhaCounter, ...rest }) => rest
    );

    return NextResponse.json(formattedResult, { status: 200 });
  } catch (err) {
    console.error("Database query error:", err);
    return NextResponse.json(
      { error: "Database query error" },
      { status: 500 }
    );
  }
}
